---
stages:
  - build
  - test

# Build du backend (Spring Boot & Java 21)
build_backend:
  stage: build
  image: maven:3.9.6-eclipse-temurin-21  # Image Maven avec Java 21 intégré
  script:
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - target/*.jar  # Sauvegarde du fichier JAR compilé

# Build du frontend (React 18)
build_frontend:
  stage: build
  image: node:20  # Utilisation de Node.js 20 pour éviter les erreurs
  script:
    - cd frontend
    - npm install
    - CI='' npm run build  # Correction de l’erreur ESLint qui bloque le build
  artifacts:
    paths:
      - frontend/build/

# Tests backend (JUnit & Spring Boot Test)
test_backend:
  stage: test
  image: maven:3.9.6-eclipse-temurin-21
  script:
    - mvn test -X  # Active le mode debug pour voir les erreurs détaillées

# Tests frontend (React + Jest)
test_frontend:
  stage: test
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm test -- --watchAll=false  # Désactive le mode interactif Jest

