stages:
  - build
  - test

# ğŸ”¹ Build du backend (Spring Boot & Java 21)
build_backend:
  stage: build
  image: maven:3.9.6-eclipse-temurin-21  # Image Maven avec Java 21 intÃ©grÃ©
  script:
    - mvn clean package -DskipTests
  artifacts:
    paths:
      - target/*.jar  # Sauvegarde du fichier JAR compilÃ©

# ğŸ”¹ Build du frontend (React 18)
build_frontend:
  stage: build
  image: node:20  # Utilisation de Node.js 20 pour Ã©viter les erreurs
  script:
    - cd frontend
    - npm install
    - CI='' npm run build  # Correction de lâ€™erreur ESLint qui bloque le build
  artifacts:
    paths:
      - frontend/build/

# ğŸ”¹ Tests backend (JUnit & Spring Boot Test)
test_backend:
  stage: test
  image: maven:3.9.6-eclipse-temurin-21
  script:
    - mvn test -X  # Active le mode debug pour voir les erreurs dÃ©taillÃ©es

# ğŸ”¹ Tests frontend (React + Jest)
test_frontend:
  stage: test
  image: node:20
  script:
    - cd frontend
    - npm install
    - npm test -- --watchAll=false  # DÃ©sactive le mode interactif Jest

# ğŸ”¹ ExÃ©cuter le pipeline sur toutes les branches
rules:
  - if: '$CI_COMMIT_BRANCH'
